<script lang="ts">
    import {generateIdenteapot} from "@teapotlabs/identeapots";
    import { slide } from "svelte/transition";
    import WharfService, {account} from "$lib/wharf";

    $: connected = !!$account;
    let identipot: string|undefined;

    account.subscribe(async (value) => {
        if(value) {
            identipot = await generateIdenteapot(value);
        } else {
            identipot = undefined;
        }
    });

    let hovering = false;
</script>

<header>
    <nav class="flex justify-between items-center p-6 relative z-10 max-lg:flex-col max-lg:gap-10">
        <a href="https://eosnetwork.com" target="_blank" rel="noopener noreferrer">
            <svg width="127" height="30" viewBox="0 0 127 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M27.9031 21.1009L27.7257 20.4209L25.6974 12.8759L23.2331 3.71098L22.7098 1.76049C22.5735 1.25581 22.2743 0.809948 21.8587 0.491762C21.443 0.173576 20.9338 0.000760025 20.4099 0L7.54447 0C7.02061 0.00109549 6.51165 0.174038 6.09604 0.492173C5.68042 0.810308 5.38121 1.25598 5.24453 1.76049L0.232679 20.4204L0.049746 21.1019C-0.0332416 21.4112 -0.0119601 21.7391 0.11031 22.0351C0.232579 22.3311 0.449048 22.5788 0.726346 22.7399L3.09545 24.1064L12.7824 29.6829C13.1443 29.8906 13.5546 30 13.9722 30C14.3898 30 14.8 29.8906 15.162 29.6829L26.6101 23.0909L27.2225 22.7389C27.5005 22.5783 27.7177 22.3309 27.8407 22.0348C27.9637 21.7388 27.9857 21.4106 27.9031 21.1009ZM1.87957 22.1609C1.63064 22.0172 1.43615 21.7957 1.32625 21.5305C1.21634 21.2654 1.19714 20.9715 1.27164 20.6944L4.19004 9.82696L5.75975 3.98448C5.77924 3.90169 5.82679 3.82815 5.89437 3.7763C5.96196 3.72446 6.04541 3.6975 6.13063 3.69998C6.21589 3.69731 6.29944 3.7242 6.36706 3.77607C6.43468 3.82794 6.48219 3.90159 6.5015 3.98448L10.2559 17.9624L12.838 27.5774C12.8608 27.6641 12.8574 27.7556 12.8283 27.8404C12.7992 27.9252 12.7456 27.9995 12.6743 28.054C12.603 28.1086 12.5171 28.1409 12.4275 28.1469C12.3378 28.1529 12.2484 28.1324 12.1704 28.0879L3.64124 23.1734L1.87957 22.1609ZM6.12963 2.60449L6.13614 2.62949H6.12261L6.12963 2.60449ZM15.7825 28.0879C15.7046 28.1328 15.615 28.1537 15.5252 28.1479C15.4354 28.142 15.3494 28.1097 15.278 28.0551C15.2066 28.0004 15.1531 27.9258 15.1242 27.8408C15.0954 27.7557 15.0925 27.6641 15.1159 27.5774L15.3865 26.5789L21.4524 3.99298C21.4752 3.91228 21.5239 3.84123 21.5909 3.79063C21.6579 3.74003 21.7397 3.71265 21.8237 3.71265C21.9078 3.71265 21.9896 3.74003 22.0566 3.79063C22.1236 3.84123 22.1723 3.91228 22.1951 3.99298L24.8123 13.7429L26.6822 20.7009C26.756 20.9779 26.7364 21.2713 26.6264 21.5361C26.5165 21.8008 26.3223 22.0221 26.0738 22.1659L19.0803 26.1929L15.7825 28.0879ZM21.8237 2.60549L21.8308 2.63049H21.8172L21.8237 2.60549ZM20.2235 1.0705C20.3292 1.07052 20.4335 1.09475 20.5283 1.14133C20.6232 1.18791 20.706 1.25559 20.7705 1.33916C20.835 1.42273 20.8794 1.51995 20.9003 1.62334C20.9212 1.72673 20.918 1.83352 20.891 1.93549L20.4159 3.70698L17.2264 15.5939L14.3526 26.2899C14.3291 26.3698 14.2804 26.4399 14.2136 26.4899C14.1468 26.5398 14.0656 26.5667 13.9822 26.5667C13.8988 26.5667 13.8176 26.5398 13.7508 26.4899C13.684 26.4399 13.6353 26.3698 13.6118 26.2899L7.81662 4.70498L7.54798 3.70998L7.07185 1.93899C7.04458 1.83679 7.04123 1.7297 7.06204 1.626C7.08286 1.5223 7.12729 1.42476 7.19191 1.34092C7.25653 1.25707 7.3396 1.18917 7.43471 1.14246C7.52982 1.09574 7.63442 1.07146 7.74044 1.0715L20.2235 1.0705ZM41.7489 1.0745H48.7895V2.00699H42.7633V5.87397H48.4267V6.82497H42.7633V11.085H48.7895V12.0284H41.7494V1.075L41.7489 1.0745ZM54.6404 12.2214C51.536 12.2214 49.618 9.87946 49.618 6.54097C49.618 3.20199 51.54 0.875996 54.6404 0.875996C57.7412 0.875996 59.6683 3.20299 59.6683 6.54097C59.6683 9.87896 57.7447 12.2209 54.6404 12.2209V12.2214ZM54.6404 11.2575C56.8817 11.2575 58.5932 9.55096 58.5932 6.54447C58.5932 3.53848 56.8817 1.84699 54.6404 1.84699C52.3996 1.84699 50.689 3.53848 50.689 6.54447C50.689 9.55096 52.3996 11.2575 54.6404 11.2575ZM64.6671 0.877996C66.8327 0.877996 68.3468 1.93799 68.7557 3.80898H67.6932C67.3153 2.53999 66.2443 1.84549 64.5588 1.84549C63.4537 1.84549 61.894 2.28249 61.894 3.71848C61.894 4.82098 62.7871 5.36448 64.019 5.65148L65.3206 5.94047C66.8963 6.30297 69.0154 6.92247 69.0154 9.02396C69.0154 11.1255 67.0923 12.2269 64.9588 12.2269C62.2173 12.2269 60.7037 10.7005 60.4616 8.73696H61.5241C61.896 10.487 63.1069 11.2575 64.9122 11.2575C66.108 11.2575 67.9558 10.82 67.9558 9.18896C67.9558 7.85897 66.6538 7.22497 65.1091 6.89247L63.7309 6.58997C62.29 6.27097 60.8556 5.56098 60.8556 3.76398C60.8556 1.75449 62.8954 0.877996 64.6671 0.877996ZM81.5254 12.0284L75.5137 2.16499V12.0289H74.4993V1.075H75.9678L81.9795 10.955V1.074H82.9934V12.0279L81.5254 12.0284ZM84.5441 7.99297C84.5441 5.37998 86.179 3.76398 88.3601 3.76398C90.6465 3.76398 92.1155 5.69697 91.9937 8.23496H85.5134C85.559 10.2145 86.7859 11.362 88.4508 11.362C89.7228 11.362 90.6165 10.728 90.9342 9.59446H91.9185C91.5096 11.2865 90.1924 12.2234 88.3902 12.2234C86.0131 12.2214 84.5441 10.516 84.5441 7.99347V7.99297ZM85.5434 7.37347H90.9643C90.9643 5.99947 89.9799 4.60898 88.3446 4.60898C86.831 4.60898 85.7404 5.56098 85.5434 7.37397V7.37347ZM93.5293 2.07199H94.4836V3.90248H96.0889V4.71748H94.4836V9.90846C94.4836 10.9515 94.5137 11.178 95.6042 11.178H96.0869V12.0284H95.3141C93.8656 12.0284 93.5273 11.7114 93.5273 10.095V4.71498H92.1751V3.89998H93.5273L93.5293 2.07199ZM101.606 3.89998H102.545L104.635 10.561L106.373 3.89998H107.418L105.059 12.0289H104.18L102.045 5.20098L99.9736 12.0289H99.104L96.7414 3.90198H97.7869L99.5882 10.551L101.606 3.89998ZM111.346 3.76398C113.299 3.76398 115.04 5.03198 115.04 7.99297C115.04 10.9545 113.302 12.2229 111.346 12.2229C109.407 12.2229 107.666 10.9545 107.666 7.99297C107.666 5.03198 109.407 3.76398 111.346 3.76398ZM111.346 11.362C112.906 11.362 114.041 10.3345 114.041 7.98947C114.041 5.64398 112.906 4.61648 111.346 4.61648C109.771 4.61648 108.666 5.64398 108.666 7.98947C108.666 10.3345 109.771 11.362 111.346 11.362ZM119.985 4.85098C119.91 4.83923 119.834 4.83421 119.758 4.83598H119.565C117.885 4.83598 117.344 6.04447 117.344 7.76647V12.0284H116.42V3.89998H117.313V5.37998C117.677 4.42848 118.752 3.83848 119.721 3.83848H119.842C119.893 3.83598 119.944 3.84098 119.993 3.85398L119.985 4.85148V4.85098ZM121.856 1.0745V7.96297L125.581 3.89948H126.729L123.716 7.16247L127 12.0269H125.909L123.108 7.82697L121.853 9.18696V12.0284H120.914V1.075H121.856V1.0745ZM41.7489 17.6484H48.4572V18.5809H42.7638V22.4479H48.1059V23.3989H42.7633V28.6024H41.7494L41.7489 17.6484ZM52.605 20.3379C54.5582 20.3379 56.2993 21.6059 56.2993 24.5669C56.2993 27.5284 54.5607 28.7969 52.605 28.7969C50.6489 28.7969 48.9248 27.5284 48.9248 24.5669C48.9248 21.6059 50.6665 20.3379 52.605 20.3379ZM52.605 27.9359C54.1637 27.9359 55.2999 26.9084 55.2999 24.5634C55.2999 22.2179 54.1637 21.1904 52.605 21.1904C51.0298 21.1904 49.9247 22.2179 49.9247 24.5634C49.9247 26.9084 51.0298 27.9359 52.605 27.9359ZM62.7786 27.2864C62.3701 28.0574 61.5672 28.7974 60.1589 28.7974C58.297 28.7974 57.5086 27.6489 57.5086 25.6549V20.4734H58.4474V25.3974C58.4474 26.9239 58.8117 27.9514 60.4015 27.9514C61.688 27.9514 62.7786 26.7729 62.7786 25.0509V20.4739H63.7173V28.6024H62.7786V27.2864ZM66.5019 21.8479C66.9104 21.0769 67.6832 20.3379 69.2118 20.3379C71.1349 20.3379 71.9533 21.4854 71.9533 23.4789V28.6024H71.0146V23.7364C71.0146 22.2114 70.6056 21.1829 68.9698 21.1829C67.5614 21.1829 66.5019 22.3614 66.5019 24.0829V28.6029H65.5627V20.4729H66.5019V21.8479ZM76.5923 20.3374C77.8031 20.3374 78.7574 20.8964 79.3478 21.8794V17.6494H80.2865V28.6024H79.3478V27.2724C78.7574 28.2364 77.8021 28.7989 76.5923 28.7989C74.7143 28.7989 73.1852 27.2729 73.1852 24.5689C73.1852 21.8649 74.7143 20.3374 76.5923 20.3374ZM76.7852 21.1824C75.2707 21.1824 74.1956 22.4064 74.1956 24.5669C74.1956 26.7269 75.2707 27.9509 76.7852 27.9509C78.0111 27.9509 79.4049 26.9874 79.4049 24.5669C79.4049 22.1464 78.0146 21.1829 76.7933 21.1829L76.7852 21.1824ZM87.3863 27.3614C86.8561 28.2229 85.8412 28.7974 84.3276 28.7974C82.814 28.7974 81.6327 27.9204 81.6327 26.5809C81.6327 24.7229 83.4495 24.0759 87.3708 23.6649V23.3759C87.3708 21.5174 86.2662 21.1249 85.1004 21.1249C83.7066 21.1249 82.8892 21.8804 82.813 22.9559H81.8287C82.0567 21.3389 83.3287 20.2974 85.16 20.2974C87.053 20.2974 88.31 21.0824 88.31 23.4994C88.31 24.6324 88.2945 25.3569 88.2945 26.0044C88.2945 26.9269 88.3406 27.7124 88.3912 28.6064H87.4364L87.3863 27.3614ZM84.5401 27.9654C86.0536 27.9654 87.4164 27.1804 87.4164 24.8819V24.4899C84.1161 24.8524 82.6767 25.3049 82.6767 26.5589C82.6767 27.4259 83.4495 27.9654 84.5401 27.9654ZM90.2967 18.6454H91.251V20.4764H92.8552V21.2914H91.251V26.4829C91.251 27.5254 91.281 27.7519 92.3711 27.7519H92.8542V28.6024H92.0814C90.6325 28.6024 90.2947 28.2854 90.2947 26.6684V21.2884H88.9425V20.4734H90.2947L90.2967 18.6454ZM94.9271 17.6484V19.1434H93.9854V17.6484H94.9271ZM94.9271 20.4734V28.6024H93.9854V20.4734H94.9271ZM99.9736 20.3379C101.927 20.3379 103.668 21.6059 103.668 24.5669C103.668 27.5284 101.93 28.7969 99.9736 28.7969C98.0355 28.7969 96.2939 27.5284 96.2939 24.5669C96.2939 21.6059 98.0315 20.3379 99.9736 20.3379ZM99.9736 27.9359C101.533 27.9359 102.668 26.9084 102.668 24.5634C102.668 22.2179 101.533 21.1904 99.9736 21.1904C98.3984 21.1904 97.2932 22.2179 97.2932 24.5634C97.2932 26.9084 98.3943 27.9359 99.9736 27.9359ZM105.975 21.8479C106.384 21.0769 107.156 20.3379 108.685 20.3379C110.608 20.3379 111.427 21.4854 111.427 23.4789V28.6024H110.487V23.7364C110.487 22.2114 110.079 21.1829 108.443 21.1829C107.035 21.1829 105.975 22.3614 105.975 24.0829V28.6029H105.036V20.4729H105.975V21.8479Z" fill="white"/>
            </svg>
        </a>

        {#if !connected}
            <button class="bg-white text-black rounded-full py-2 px-6 cursor-pointer" on:click={WharfService.login}>
                Connect Wallet
            </button>
        {:else}
            <section class="h-[40px] flex" on:mouseenter={() => hovering = true} on:mouseleave={() => hovering = false}>
                <section on:click={() => hovering = !hovering}>
                    <section class="logged-in">
                        <figure class="">
                            {$account}
                        </figure>


                        <img src="{identipot}" alt="identipot" class="h-[30px] aspect-square rounded-full"/>

                    </section>
                </section>
                <button class:open={hovering} class="change" on:click={WharfService.logout}>
                    Change
                </button>
            </section>
        {/if}
    </nav>
</header>

<style lang="scss">
    .logged-in {
        border-radius: 122px;
        background: #010309;
        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
        backdrop-filter: blur(6.800000190734863px);

        background: linear-gradient(135deg, rgba(119, 97, 255, 0.7) 6.43%, rgba(255, 235, 53, 0.4) 94.54%);

        &:after {
            content: '';
            position: absolute;
            background:#000;
            top: 2px;
            bottom: 2px;
            left: 2px;
            right: 2px;

            border-radius: 122px;
            z-index: -1;
        }

        @apply
            text-white
            px-2 pl-6
            gap-4
            h-[44px]
            items-center
            cursor-pointer
            flex;

    }

    .change {
        @apply
            bg-red-600
            text-white
            rounded-full
            flex
            items-center
            h-[44px]
            text-sm
            hover:bg-red-700
            max-w-0
            overflow-hidden;

        transition: padding 0.4s ease,  max-width 0.4s ease, margin-left 0.5s 0.2s ease, background 0.2s ease;

        &.open {
            @apply
                px-6
                pl-12
                -ml-10
                max-w-[200px];
            transition: padding 0.1s 0.2s ease,  max-width 0.1s 0.2s ease, margin-left 0.5s ease, background 0.2s ease;
        }
    }
</style>
